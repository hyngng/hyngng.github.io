---
title:  "[Python] ASTP : 자동주식거래기"

categories: [프로그래밍, 프로젝트]
tags:
  - [프로그래밍, 주식, 파이썬]

toc: true
toc_sticky: true
 
date: 2022-12-28
last_modified_at: 2023-04-13
---

<br>

# **A**uto **S**tock **T**rading **P**rogram

ASTP는 파이썬으로 작성된 단순 주식 자동 매매 프로그램으로, 두 전략을 따른다.

- NDX 지수와 NASDAQ 상장 1, 2위 기업의 비율을 고려하여 주식을 매수할 것.
- NDX 지수가 폭락하거나, 환율이 과도하게 상승하는 등의 상황에서 보유주식을 전량 매도하고 20영업일간 매매활동을 중지할 것.

<br>

위의 전략은 세부적으로 아래과 같이 구현되어 있다.
- 한국투자증권의 OpenAPI를 이용한다. Key, Secret, 가상 계좌번호를 별도의 mock.key 파일에 저장한 뒤 프로그램이 이를 읽어온다. 
- NDX 지수 폭락 여부를 판단하기 위해, 장 시작, 장 종료 시점에 매일 두 번씩 NDX지수를 입력받아 엑셀에 저장한다. 프로그램이 실행될 때마다 엑셀 데이터를 읽고 최대값과 최솟값을 비교하여 NDX 지수 폭락 여부를 판단한다.
- [Yahoo Finance NASDAQ 100](https://finance.yahoo.com/quote/%5ENDX/) 페이지에서 NDX지수를 크롤링하여 사용한다. OpenAPI와 FinanceDataReader 라이브러리 모두 NDX지수를 제공하지 않음에 따른 대안이다.

<br>

---

<br>

# 사전작업

## OpenAPI 이용 신청

한국투자증권 계좌를 개설하고 OpenAPI 이용을 신청해야 한다. [한국투자증권 API(eFriend Expert)](https://www.truefriend.com/main/customer/systemdown/OpenAPI.jsp?cmd=TF04ea01200) 페이지에서 OpenAPI 이용을 신청한 뒤 `key`와 `secret`을 발급받고 `eFriend Expert` 프로그램을 설치한다.

<br>

## 라이브러리 설치

```terminal
pip install mojito2
pip install finance-datareader
```

- [mojito2](https://pypi.org/project/mojito2/) 라이브러리는 한국투자증권의 RestAPI 기반의 OpenAPI에 대한 통합 파이썬 레퍼 모듈이다. 라이브러리명이 모히또인 이유가 재미있는데, 공식 설명으로는 이 라이브러리가 통합 모듈이기도 하고 돈 벌어서 몰디브가서 모히토 한 잔 하자는 의미도 있다고 한다.
- [yfincance](https://pypi.org/project/yfinance/) 라이브러리는 나스닥에 상장된 시가총액 1위 기업과 2위 기업에 대한 데이터를 불러오기 위해 사용한다.
- [FinanceDataReader](https://github.com/financedata-org/FinanceDataReader) 라이브러리는 OpenAPI의 기능을 보조하기 위한 수단으로, 시가총액 상위 10개 기업 데이터를 얻어오기 위해 사용한다.
- [pandas](https://pandas.pydata.org/) 라이브러리는 엑셀 데이터를 읽어오기 위해 사용한다.
- [re](https://docs.python.org/3/library/re.html) 라이브러리는 파이썬 정규식을 사용하기 위해 사용한다.

이외 `datetime` 라이브러리의 경우 파이썬이 기본 제공하는 라이브러리로 별도의 설치가 필요하지 않다.

<br>

---

# 이외 주의사항

한국투자증권 계좌로 API를 신청한 후 Key, Secret을 발급받아 사용하며, 본 코드의 경우 별도의 `mock.key`라는 별도의 파일에 Key, Secret정보를 저장하여 코드에서 읽어오도록 구성했다.

<br>

![image](https://user-images.githubusercontent.com/96360829/235820176-3cff59e7-0be2-42ee-ae37-27d842eb161a.png)
공동인증서 모듈이 64bit를 미지원하는 이슈가 있기 때문에, 코드를 정상적으로 실행하기 위해서는 32bit 가상환경을 구축할 필요가 있다. (자세한 것은 [VsCode에서 32비트 가상환경 구축하기](https://kiw6024.github.io/posts/32bit/)를 참조)

<br>

미국 장은 한국시간으로 밤 11:30부터 다음날 아침 6:30까지 열리기 때문에, 일반적인 프로그램과 다르게 ASTP는 코드 동작을 확인할 수 있는 시간에 제약이 있다.

<br>

---

<br>

# 프로젝트를 통해 알게 된 점

API 연결 방식에 OCX, COM, DLL 등이 있음. (한투는 OCX)
OCX (OLE Control Extension) is a file format that contains reusable software components, which can be used to create custom user interfaces and add functionality to applications. These components are also known as ActiveX controls.

<br>

[찾아보니](https://stockant.tistory.com/343) 안드로이드 어플 형식으로 개발이 가능한 것 같았다. 

<br>

---

[^1]: 