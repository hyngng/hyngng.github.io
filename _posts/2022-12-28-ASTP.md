---
title:  "[Python] ASTP : 자동주식거래기"

categories: [프로그래밍, 프로젝트]
tags:
  - [프로그래밍, 주식, 파이썬]

toc: true
toc_sticky: true
 
date: 2022-12-28
last_modified_at: 2023-04-13
---

<br>

# **A**uto **S**tock **T**rading **P**rogram

ASTP는 파이썬으로 작성된 단순 주식 자동 매매 프로그램으로, 두 전략을 따른다.

> 1. NDX 지수와 NASDAQ 상장 1, 2위 기업의 비율을 고려하여 주식을 매수할 것.<br>2. NDX 지수가 폭락하거나, 환율이 과도하게 상승하는 등의 상황에서 보유주식을 전량 매도하고 20영업일간 매매활동을 중지할 것.  
ASTP는 한국투자증권의 OpenAPI를 이용하며, 이외 [Yahoo Finance](https://finance.yahoo.com/quote/NQ=F?p=NQ=F&.tsrc=fin-srch) 페이지의 NDX지수를 크롤링하여 사용하고 있다.

<br>

---

<br>

# 사전작업

한국투자증권 계좌를 개설하고 API 이용을 신청해야 한다. [한국투자증권 API(eFriend Expert)](https://www.truefriend.com/main/customer/systemdown/OpenAPI.jsp?cmd=TF04ea01200) 페이지에서 API 이용 신청하고 key와 secret을 발급받고 'eFriend Expert' 프로그램을 설치한다.

<br>

# 라이브러리 설치

```terminal
pip install mojito2
pip install finance-datareader
```

`mojito` 라이브러리는 한국투자증권의 Rest API 기반의 Open API에 대한 통합 파이썬 레퍼 모듈이다. 라이브러리명이 '모히토'인 이유가 재미있는데, 공식 설명으로는 이 라이브러리가 통합 모듈이기도 하고, 돈 벌어서 몰디브가서 모히토 한 잔 하자는 의미도 있다고 한다.  
`FinanceDataReader` 라이브러리는 OpenAPI의 기능을 보조하기 위한 수단으로, 시가총액 상위 10개 기업 데이터를 얻어오기 위해 사용한다.

<br>

---

# 이외 주의사항

한국투자증권 계좌로 API를 신청한 후 APP Key, APP Secret를 발급받아 사용하며, 본 코드의 경우 별도의 mock.key 파일에서 정보를 읽어오도록 구성함.

<br>

공동인증서 모듈이 64bit를 미지원하는 이슈가 있기 때문에, 코드를 정상적으로 실행하기 위해서는 32bit 가상환경을 구축할 필요가 있음. (자세한 것은 [VsCode에서 32비트 가상환경 구축하기](https://kiw6024.github.io/posts/32bit/)를 참조)

<br>

미국 장은 한국시간으로 밤 11:30부터 다음날 아침 6:30까지 열리기 때문에, 일반적인 경우와 달리 ASTP는 코드 동작을 확인할 수 있는 시간에 강한 제약이 있다.

<br>

---

<br>

# 프로젝트를 통해 알게 된 점

API 연결 방식에 OCX, COM, DLL 등이 있음. (한투는 OCX)
OCX (OLE Control Extension) is a file format that contains reusable software components, which can be used to create custom user interfaces and add functionality to applications. These components are also known as ActiveX controls.

<br>

---
## <b>참고</b>
[Python Package Index | mojito2](https://pypi.org/project/mojito2/)
[안드로이드 개발 시 참고](https://stockant.tistory.com/343)
[GitHub | ASTP](https://github.com/kiw6024/ASTP)