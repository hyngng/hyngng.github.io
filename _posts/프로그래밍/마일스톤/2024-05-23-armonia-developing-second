---
title: "횡스크롤 감성 게임 개발하기: 프로토타입 개발 과정 두 번째"

categories: [프로그래밍, 마일스톤]
tags: [프로그래밍, 유니티, C#, 개발일지]
start_with_ads: true

image:
    path: /2024-05-31-armonia-developing-second/prototype-gameplay.webp
    lqip: data:image/webp;base64,UklGRlYAAABXRUJQVlA4IEoAAADwAQCdASoQAAgAAUAmJQBOgB8xi/GXoBAA/vuITP1jzd5vh9i82itNyxKJOlCBXvOebik8444+JnSUJik6FdPY8GR+D5jZO/WAAA==
    alt: 개발중인 프로토타입

toc: true
toc_sticky: true

lang: ko

date: 2024-05-28 18:14:00 +0900
last_modified_at: 2024-05-28 18:14:00 +0900

mermaid: true
---

## **들어가며**

> [전 글](https://hynrng.github.io/posts/armonia-developing-first/)에서 이어집니다.
{: .prompt-info }

제 [네 번째 마일스톤](https://hynrng.github.io/categories/%EB%A7%88%EC%9D%BC%EC%8A%A4%ED%86%A4/) 개발기입니다. 다시 한 번 한 달 동안 만든 결과물을 정리했습니다. 이번 한 달은 조금 지친건지 개발이 분명 즐겁긴 한데 한 편으로는 힘들고 손이 가지 않는 부분이 있었습니다. 이번 단계에서 만든 것은 다음과 같습니다.

게임 시스템
: - [x] 배경 오브젝트 계층화
- [x] 셰이더 그래프 교체를 통한 최적화
- [x] 핀치 줌아웃으로 접근 가능한 설정창
- [x] 절차적 애니메이션을 이용한 오브젝트 상호작용

추가된 오브젝트
: - [x] 뒷배경 역할을 하는 2종의 건물 오브젝트

## **애셋**

### **이미지 에셋**

![pigeon-digging](/2024-05-31-armonia-developing-second/pigeon-digging.webp){: .light .border }
![pigeon-digging](/2024-05-31-armonia-developing-second/pigeon-digging.webp){: .dark }
_땅 쪼는 비둘기_

[전 경우](https://hynrng.github.io/posts/armonia-developing-first/#%EC%95%A0%EB%8B%88%EB%A9%94%EC%9D%B4%EC%85%98-%EC%97%90%EC%85%8B)와 같이 키프레임 형식의 애니메이션을 조금 더 만들었습니다. 대부분의 경우 애니메이션 분량이 짧고, 전에 그려둔 이미지를 덧씌우는 식으로 재활용했더니 어렵지 않았습니다.

### **셰이더 파일**

- 2D 셰이더 새로 찾아 적용함 (후술할거임)

문제는, 그림자 생성(Cast shadow)이 이루어지지 않고 포스트 프로세싱의 심도(DOF) 효과가 적용되지 않습니다. 가능하면 개선할 수 있으면 좋겠지만 포기해야 하나 고민되네요.

## **개발**

### **설정창 구상 및 구현**

![settings-activated](/2024-05-31-armonia-developing-second/settings-activated.webp){: .w-75 }
_핀치 줌으로 설정창 진입할 수 있음_

설정창은 재밌게 만들어보고 싶었습니다. 흔히 버튼을 모서리에 배치하는 식으로 해결하지만 그것은 [전에 이미 만들어본 적](https://hynrng.github.io/posts/palette-developing/)있었고, 그보다는 좀 더 특별한 경험을 만들면서도 깔끔한 화면을 최대한 보존하고 싶었습니다.

그래서 핀치 줌으로 접근할 수 있도록 만들었습니다. 핀치 줌은 단계적으로 작동하며, 일정 범위 이내에서는 평범한 카메라 줌인아웃으로 연결되지만 일정 범위를 넘어서면 설정창으로 진입하게 됩니다. 한 번 접근한 설정창은 핀치 줌인으로 나갈 수 있습니다.

이 기능을 만들면서 UI는 마치 카메라처럼 보이도록 만들었습니다. 평소 즐겨보는 Street Photography 컨텐츠에서 기기를 통해 정렬된 세상을 보는 느낌이 좋아 그 영화를 찍는 듯한 제작 감각을 옮겼습니다. 배터리나 시간은 (코드)나 (코드)를 가져왔기 때문에 진짜로 작동함

아직 완성되지 않았기 때문에 실제로 사용해보더라도 경험이 유기적으로 이어진다는 느낌이 들어 만족스럽네요.

<!--하단 스와이프창 만들거임.-->

### **절차적 애니메이션 적용**

![people-staring-pigeons](/2024-05-31-armonia-developing-second/people-staring-pigeons.webp){: .w-75 }
_근처에 비둘기 있으면 한 번씩 쳐다봄_

절차적 애니메이션으로 만든 결과물을 보고 멋지다고 생각한 적이 있어서 기억해두고 있다가 이번에 시도해봤습니다. 기술적으로 복잡하게 구현하는 것인 줄 알았는데 생각보다 쉬웠고, 코드로 제어하는 것이 생각보다 더러워서 어려웠음.

```cs
public void ChangeSourceObject(GameObject discoveredObject)
{
    WeightedTransformArray sourceObjects = Constraint.data.sourceObjects;
    WeightedTransformArray newSourceObjects = new WeightedTransformArray(sourceObjects.Count);
    
    newSourceObjects[0] = new WeightedTransform();
    WeightedTransform wt = newSourceObjects[0];

    /* ... */

    newSourceObjects[0] = wt;
    
    data.sourceObjects = newSourceObjects;

    Animator.enabled = false;
    rigBuilder.Build();
    Animator.enabled = true;
}
```
{: file="People.cs" }

우와, 힘들었습니다. 비둘기와 달리 사람은 머리, 몸, 다리 등이 개별 오브젝트로 독립적으로 나뉘어져 있어 적용해봤습니다.

혹시라도 절차적 애니메이션의 `sourceObject`를 코드로 변경하고 싶은 분이 계신다면 다음을 참고하시면 도움이 될 것 같습니다.
: - `sourceObjects`의 속성은 읽기 전용(read-only)입니다. 다른 지역 변수에 데이터 정의 후 `data.sourceObjects`에 새 값을 지정해야 합니다.
- 해당 오브젝트의 애니메이터를 비활성화한 상태로 `rigBuilder`를 빌드 후 애니메이션을 재활성화해야 적용됩니다.

나중에 3D 토이프로젝트 라도 만들게 되면 꼭꼭 더 잘 활용해보고 싶다는 생각이 들었습니다.

### **프로파일러를 이용한 최적화**

이상하게도 빌드 후 40FPS 유지가 안 될 정도로 발열이 심했습니다. 제 코드가 완벽하지는 않더라도 `GetComponent()`, `Find()` 등 무거운 함수나 `for`, `foreach`, 코루틴 등의 반복 동작이 있는 코드 등이 무리하게 실행되지 않도록 기본적인 부분은 지켜주며 코드를 작성했는데, 이해가 가지 않았습니다.

금방 뜨끈뜨끈해지는 폰이 신경쓰여서 해결해줬음. 프로파일러

[전에 발견한](https://hynrng.github.io/posts/armonia-developing-first/#%EC%8A%A4%ED%94%84%EB%9D%BC%EC%9D%B4%ED%8A%B8-%EC%85%B0%EC%9D%B4%EB%8D%94) 그림자 생성 Sprite용 셰이더가 리소스를 너무 많이 먹어서 필요한 부분 빼고 Default로 바꿔줬음.
- 근데 앞뒤 구분 안 된 채 렌더링되는 오류 나서 셰이더 또 찾아서 적용해줬음.
- 완벽하진 않지만 60FPS 방어 잘됨.

## **출시 기준**

- 예전에 유니티가 발간한 게임 업계 보고서에서 "씹을 수 있을 만큼만 물어라(Don't bite off more than you can chew)"라는 충고를 본 적이 있음. 지금 내 상황이 딱 이런듯.
- 오브젝트를 다양화하고, 애니메이션과 상호작용을 만들고, 이게 혼자서는 너무 시간과 노력이 생각보다 많이 들어서, 어느 순간 끝이 안 보이는 터널을 지나는 느낌이 들더라구요.

그래서 출시 기준을 생각해봤습니다. 

- 구글에 피처링이라는게 있는데 이 기준을 적용하려 함.

이 프로젝트는 끝까지 가보고 싶은데 어디까지 만들어야 하는지에 대한 기준이 없었습니다. 구글 피처링 신청 가능한 정도로만 만들어보고 싶습니다.

피처링 선별 조건은 다음을 제시하고 있습니다.
: - [구글플레이 정책](https://play.google/developer-content-policy/#!?modal_active=none) 준수 여부
- 안드로이드와 구글플레이 [핵심 앱 품질 가이드라인 준수](https://developer.android.com/quality?hl=ko) 여부
- [높은 사용자 평점](https://support.google.com/googleplay/android-developer/answer/138230?hl=en)
- [높은 안드로이드 바이탈(Android Vitals)](https://support.google.com/googleplay/android-developer/answer/9844486?hl=en&visit_id=638527380779176477-2227653483&rd=1) 점수 

## **마치며**

6월에 사회복무요원 복무가 시작됩니다. 훈련소를 가야 하죠.

향후 간간히 개발하고 싶습니다. 스토어 등록까지는 해보고 마치고 싶네요.