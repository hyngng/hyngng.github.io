---
title:  "주식 자동매매 프로그램 ASTP"

categories: [프로그래밍, 마일스톤]
tags: [프로그래밍, 주식, 파이썬]

toc: true
toc_sticky: true
 
date: 2022-12-28
last_modified_at: 2023-05-04
---

# **들어가며**

**ASTP**[^1]는 내부 알고리즘으로 주식을 자동 매매하는 프로그램을 목표로 기획된 프로젝트로, **[제 두 번째 마일스톤](https://kiw6024.github.io/categories/%EB%A7%88%EC%9D%BC%EC%8A%A4%ED%86%A4/)**입니다. 기획 자체는 2021년 말에 했는데, 시작을 1년 뒤에 하기 시작해 2023년을 바라보는 날이 되어서야 완성을 했네요.

프로그램은 파이썬으로 작성했고, 현재로서는 단순한 전략을 따르는 형태로 간단히 완성했습니다. 주식 관련해서는 흥미가 많지 않아, 지인의 작은 도움을 받았습니다.

# **프로그램 특징**

[한국투자증권의 OpenAPI](https://www.truefriend.com/main/customer/systemdown/OpenAPI.jsp?cmd=TF04ea01200)를 사용했습니다. 프로그램을 작성하면서 API는 처음 사용해봤는데, 할 수 있는 것들이 어렵지 않게 많아져서 놀랐네요. 매매전략은 두 가지를 따르는데, 국내주식(KOSDAQ)이 아닌 **해외주식(NASDAQ)**을 기준으로 작동합니다.

- 주식 매수: NDX 지수와 나스닥 상장 1, 2위 기업의 비율을 고려하여 주식을 매수합니다.
- 주식 매도: NDX 지수가 폭락하거나 원달러 환율이 과도하게 상승할 경우 보유주식을 전량 매도하고 매매활동을 20영업일간 중지합니다.

NDX 지수 폭락 여부는 주식장 시작과 종료 시점에 두 번씩 엑셀에 입력된 NDX 지수의 최대값과 최솟값을 비교하여 판단하도록 구성했습니다.

라이브러리도 여럿 사용했는데, 대표적으로 

"한국투자증권의 RestAPI 기반의 OpenAPI에 대한 통합 파이썬 레퍼 모듈 mojito"

 NASDAQ 시가총액 순위를 가져오기 위한 사용한 `yfinance`나, 주식 관련 모듈 모두에서 누락되어있는 NASDAQ-100 수치를 크롤링으로 조달받기 위해 사용한 `BeautifulSoup`, 엑셀 데이터 입출력을 위한 `pandas` 등을 사용했습니다.

# **주의사항과 사용예**

ASTP는 생각보다 코드 외적으로 손이 많이 갔습니다. 우선적으로, 한국투자증권 서비스 이용을 위한 위한 작업이 두 가지 필요합니다.

- API 이용을 위해 한국투자증권 계좌를 개설하고 OpenAPI를 신청해야 합니다. 신청 페이지에서 `key`와 `secret`을 발급받으면 해당 값을 가상 계좌번호와 함께 프로젝트 내 `mock.key`{: .filepath }에 저장하여 사용할 수 있습니다.
- 주문 송수신이나 잔고조회 등을 처리하기 위해 한국투자증권이 제공하는 `eFriend Expert` 프로그램을 설치해야 합니다.

![ASTP_no64bit](/assets/img/2022-12-28-ASTP/ASTP_no64bit.png)

불편하게도 공동인증서 모듈이 64bit 환경을 미지원하는 이슈가 있습니다. 때문에 코드를 [32bit 가상환경을 구축하여 실행해야 합니다.](https://kiw6024.github.io/posts/32bit/)

![ASTP_example](/assets/img/2022-12-28-ASTP/ASTP_example.png){: .w-50 .left }
모든 작업이 끝나면 왼쪽과 같이 프로그램이 정상작동하는 모습을 확인할 수 있습니다. 미리 작성된 알고리즘에 따라 NDX값을 조회한 후 조건에 따라 매수주문을 올리는 모습입니다.

프로그램 외적으로, 미국 장은 한국시간으로 밤 11:30부터 다음날 아침 6:30까지 열리기 때문에, 해외주식을 기반으로 알고리즘을 구성할 경우 일반적인 프로그램과 다르게 코드 동작을 확인할 수 있는 시간에 제약이 있습니다.

# **마치며**

관심이 있는 분들은 [깃허브](https://github.com/kiw6024/ASTP)에서 둘러보실 수 있습니다.

---

[^1]: **Auto Stock Trading Program**을 축약하여 이름지었습니다.

<!--

- [mojito](https://pypi.org/project/mojito2/)는 한국투자증권의 RestAPI 기반의 OpenAPI에 대한 통합 파이썬 레퍼 모듈입니. 라이브러리명이 모히또인 이유가 재미있는데, 공식 설명으로는 이 라이브러리가 통합 모듈이기도 하고 돈 벌어서 몰디브가서 모히토 한 잔 하자는 의미도 있다고 한다.
- [yfincance](https://pypi.org/project/yfinance/)는 나스닥에 상장된 시가총액 1위 기업과 2위 기업에 대한 데이터를 불러오기 위해 사용한다.
- [FinanceDataReader](https://github.com/financedata-org/FinanceDataReader)는 OpenAPI의 기능을 보조하기 위한 수단으로, 시가총액 상위 10개 기업 데이터를 얻어오기 위해 사용한다.
- [pandas](https://pandas.pydata.org/)는 엑셀 데이터를 읽어오기 위해 사용한다.
- [re](https://docs.python.org/3/library/re.html)는 파이썬 정규식을 사용하기 위해 사용한다.

-->