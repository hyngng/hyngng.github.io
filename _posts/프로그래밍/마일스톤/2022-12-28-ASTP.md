---
title:  "파이썬과 주식, ASTP"

categories: [프로그래밍, 마일스톤]
tags: [프로그래밍, 주식, 파이썬]

toc: true
toc_sticky: true
 
date: 2022-12-28
last_modified_at: 2023-05-04
---

<br>

<!-- 개요 작성 -->
**ASTP**(Auto Stock Trading Program)은 프로그램 작성 요령을 익히기 위해 기획된 작성된 주식 자동 매매 프로젝트로, 현재로서는 파이썬을 사용하여 두 전략만을 따르는 형태로 [완성](https://github.com/kiw6024/ASTP)되었다.  
하나, NDX 지수와 나스닥 상장 1, 2위 기업의 비율을 고려하여 주식을 매수할 것.  
둘, NDX 지수가 폭락하거나, 환율이 과도하게 상승하는 등의 상황에서 보유주식을 전량 매도하고 20영업일간 매매활동을 중지할 것.

<br>

# 프로그램 특징

ASTP는 한국투자증권의 OpenAPI를 이용하며, API 이용에 필요한 `Key`, `Secret`, `가상 계좌번호` 등의 정보는 `mock.key`{: .filepath } 파일에 별도로 저장되고 `ASTP.py`{: .filepath } 프로그램이 이를 읽어오는 식으로 구현했다. NDX 지수 폭락 여부는 매일 주식 장 시작과 종료 시점에 두 번씩 엑셀에 입력된 NDX 지수의 최대값과 최솟값을 비교하여 판단한다. 사용중인 `mojito2`, `finance-datareader`, `yfinance` 파이썬 라이브러리를 포함하여 나스닥-100 지수를 제공하는 파이썬 라이브러리가 없기 때문에, [Yahoo Finance NASDAQ 100](https://finance.yahoo.com/quote/%5ENDX/) 페이지에서 NDX지수를 크롤링하여 사용한다.

<br>

---

# ASTP 사용법 및 주의법

한국투자증권 계좌를 개설하고 OpenAPI 이용을 신청해야 한다. [한국투자증권 API(eFriend Expert)](https://www.truefriend.com/main/customer/systemdown/OpenAPI.jsp?cmd=TF04ea01200) 페이지에서 OpenAPI 이용을 신청한 뒤 `key`와 `secret`을 발급받고 `eFriend Expert` 프로그램을 설치해야 한다.

<br>

ASTP는 독립된 프로그램이 아니기 때문에 라이브러리를 받아와야 한다. 필요한 라이브러리와 그에 대한 설명은 아래와 같다.

<br>

```terminal
pip install mojito2
pip install finance-datareader
pip install yfincance
pip install pandas
pip install re2
```

- [mojito](https://pypi.org/project/mojito2/)는 한국투자증권의 RestAPI 기반의 OpenAPI에 대한 통합 파이썬 레퍼 모듈이다. 라이브러리명이 모히또인 이유가 재미있는데, 공식 설명으로는 이 라이브러리가 통합 모듈이기도 하고 돈 벌어서 몰디브가서 모히토 한 잔 하자는 의미도 있다고 한다.
- [yfincance](https://pypi.org/project/yfinance/)는 나스닥에 상장된 시가총액 1위 기업과 2위 기업에 대한 데이터를 불러오기 위해 사용한다.
- [FinanceDataReader](https://github.com/financedata-org/FinanceDataReader)는 OpenAPI의 기능을 보조하기 위한 수단으로, 시가총액 상위 10개 기업 데이터를 얻어오기 위해 사용한다.
- [pandas](https://pandas.pydata.org/)는 엑셀 데이터를 읽어오기 위해 사용한다.
- [re](https://docs.python.org/3/library/re.html)는 파이썬 정규식을 사용하기 위해 사용한다.

이외 `datetime`의 경우 파이썬이 기본 제공하는 라이브러리로, 별도의 설치가 필요하지 않다.

# 주의사항

![no64bit](/assets/img/2022-12-28-ASTP/no64bit.png)

<br>

공동인증서 모듈이 64bit 환경을 미지원하는 문제가 있어, 코드가 정상적으로 실행되기 위해서는 [임의적으로 32bit 가상환경을 구축할 필요가 있다.](https://kiw6024.github.io/posts/32bit/)

<br>

미국 장은 한국시간으로 밤 11:30부터 다음날 아침 6:30까지 열리기 때문에, 일반적인 프로그램과 다르게 ASTP는 코드 동작을 확인할 수 있는 시간에 제약이 있다.

---

<!--
# 프로젝트 진행을 통해 알게 된 점

API 연결 방식에 OCX, COM, DLL 등이 있음. (한투는 OCX)
OCX (OLE Control Extension) is a file format that contains reusable software components, which can be used to create custom user interfaces and add functionality to applications. These components are also known as ActiveX controls.
-->